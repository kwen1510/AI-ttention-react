    
                <!-- Recording Controls -->
    <div class="bg-white shadow-sm border-b border-gray-200">
        <div class="w-full max-w-none mx-auto px-4 sm:px-6 lg:px-8 py-3">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-3">
                <!-- Left group: Session, Connected, Interval -->
                <div class="flex items-center gap-3">
                    <!-- Session chip (click to open QR) -->
                    <button onclick="openQrModal()" class="flex items-center gap-2 bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-full cursor-pointer shadow-sm border border-gray-200">
                        <span class="text-sm text-gray-700">Session:</span>
                        <span id="sessionCode" class="font-mono text-lg sm:text-xl font-extrabold tracking-wider">Loading...</span>
                    </button>
                    <!-- Connected pill -->
                    <div id="connectionStatus" class="flex items-center space-x-2 bg-gray-100 px-3 py-1.5 rounded-full">
                        <div id="connectionDot" class="w-2 h-2 bg-green-400 rounded-full animate-ping-slow"></div>
                        <span id="connectionText" class="text-xs font-medium text-gray-700">Connected</span>
                    </div>
                    <!-- Interval control -->
                    <div class="flex items-center space-x-2 bg-gray-100 px-3 sm:px-4 py-2 rounded-lg">
                        <label for="intervalInput" class="text-sm font-medium text-gray-700">Interval:</label>
                        <input type="number" id="intervalInput" min="10" max="120" value="30" class="w-14 sm:w-16 px-2 py-1 text-sm border border-slate-300 rounded bg-white text-black placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-300">
                        <span class="text-sm text-black/80">sec</span>
                    </div>
                </div>

                <!-- Right group: Elapsed, Start, Stop -->
                <div class="flex items-center gap-3">
                    <p class="text-gray-600 text-sm">Elapsed: <span id="timeElapsed">0:00</span></p>
                    <button id="startBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105 shadow flex items-center text-sm sm:text-base touch-friendly border border-green-600">
                        <i data-lucide="play" class="w-4 h-4 sm:w-5 sm:h-5 mr-2"></i>
                        <span class="hidden sm:inline">Start Recording</span>
                        <span class="sm:hidden">Start</span>
                    </button>
                    <button id="stopBtn" disabled class="bg-gray-300 hover:bg-gray-400 text-black px-4 sm:px-6 py-2 sm:py-3 rounded-lg font-semibold transition-all duration-200 shadow flex items-center text-sm sm:text-base touch-friendly border border-slate-300 cursor-not-allowed">
                        <i data-lucide="square" class="w-4 h-4 sm:w-5 sm:h-5 mr-2"></i>
                        <span class="hidden sm:inline">Stop Recording</span>
                        <span class="sm:hidden">Stop</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Modal -->
    <div id="qrModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50" onclick="closeQrModal(event)">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full p-6" onclick="event.stopPropagation()">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-900">Join This Session</h3>
                <button onclick="closeQrModal()" class="text-gray-400 hover:text-gray-600">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>
            <p class="text-sm text-gray-600 mb-3">Scan the QR code or visit the link below:</p>
            <div id="qrCodeContainer" class="flex items-center justify-center p-4 border border-gray-200 rounded-lg mb-4"></div>
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 font-mono text-sm break-all" id="qrLink">-</div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="page-shell page-shell--fluid stack">
        <!-- Criteria Setup Section (Collapsible) -->
        <div class="bg-white rounded-xl shadow-lg border border-gray-200 mb-8">
            <button 
                id="criteriaToggle" 
                onclick="toggleCriteriaEditor()"
                class="w-full px-6 py-4 text-left hover:bg-gray-50 transition-colors duration-200"
            >
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">Discussion Criteria Setup</h3>
                            <p class="text-sm text-gray-600">Set up your discussion question and criteria checklist</p>
                        </div>
                    </div>
                    <svg id="criteriaChevron" class="w-5 h-5 text-gray-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </div>
            </button>
            
            <div id="criteriaEditor" class="hidden border-t border-gray-200">
                <div class="p-6">
                    <div class="space-y-6">
                        <!-- Scenario/Question Section -->
                        <div>
                            <label for="scenarioInput" class="block text-sm font-medium text-gray-700 mb-2">
                                Discussion Question/Scenario
                            </label>
                            <textarea 
                                id="scenarioInput" 
                                rows="4" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-vertical"
                                placeholder="Enter the discussion question or scenario context..."
                            ></textarea>
                        </div>
                        
                        <!-- Criteria Input -->
                        <div>
                            <label for="criteriaInput" class="block text-sm font-medium text-gray-700 mb-2">
                                Criteria Checklist (one per line)
                            </label>
                            
                            <!-- Format Instructions -->
                            <div class="mb-3 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                                <h5 class="text-sm font-semibold text-blue-800 mb-3 flex items-center">
                                    <i data-lucide="info" class="w-4 h-4 mr-2"></i>
                                    üìù Criteria Format Guide
                                </h5>
                                
                                <div class="grid md:grid-cols-2 gap-4">
                                    <!-- Format Explanation -->
                                    <div>
                                        <p class="text-sm text-blue-700 mb-2">
                                            Use this format for each criterion:
                                        </p>
                                        <div class="bg-white p-3 rounded border border-blue-200 font-mono text-sm">
                                            <span class="text-green-600 font-semibold">Description</span> 
                                            <span class="text-gray-600">(</span><span class="text-orange-600 font-semibold">Rubric</span><span class="text-gray-600">)</span>
                                        </div>
                                        <div class="mt-2 text-xs text-blue-600 space-y-1">
                                            <p><span class="text-green-600 font-semibold">Description:</span> What students should demonstrate</p>
                                            <p><span class="text-orange-600 font-semibold">Rubric:</span> Specific criteria for correct answer</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Examples -->
                                    <div>
                                        <p class="text-sm font-medium text-blue-800 mb-2">‚úÖ Good Examples:</p>
                                        <div class="space-y-2 text-xs">
                                            <div class="bg-white p-2 rounded border border-green-200">
                                                <span class="text-green-600">Students explain that back titration is used</span>
                                                <span class="text-gray-500">(</span><span class="text-orange-600">CaCO3 is not soluble in water and cannot be titrated directly</span><span class="text-gray-500">)</span>
                                            </div>
                                            <div class="bg-white p-2 rounded border border-green-200">
                                                <span class="text-green-600">Students identify the need to weigh by difference</span>
                                                <span class="text-gray-500">(</span><span class="text-orange-600">there will be some CaCO3 left, so the weighing bottle must be reweighed</span><span class="text-gray-500">)</span>
                                            </div>
                                        </div>
                                        
                                        <p class="text-sm font-medium text-red-700 mb-2 mt-3">‚ùå Avoid:</p>
                                        <div class="bg-red-50 p-2 rounded border border-red-200 text-xs text-red-600">
                                            Students understand back titration because it's important...
                                            <br><span class="text-xs text-red-500">(No specific rubric in parentheses)</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- AI Grading Info -->
                                <div class="mt-3 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800">
                                    <strong>ü§ñ AI Grading:</strong> Green = Correct & Complete | Red = Attempted but Wrong | Grey = Not Discussed
                                </div>
                            </div>
                            
                            <textarea 
                                id="criteriaInput" 
                                rows="8" 
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                placeholder="Students explain that back titration is used (CaCO3 is not soluble in water and cannot be titrated directly)
Students identify that CaCO3 reacts with known volume of excess HCl (the volume of HCl used must be calculated to ensure that the titre volume is between 20 to 25 cm3)
Students identify the need to weigh by difference (there will be some CaCO3 left, so the weighing bottle must be reweighed)
Students recognise the need to cover the conical flask with a filter funnel (there is acid spray from the reaction between CaCO3 and HCl, cover to minimise loss of HCl)
Students understand that HCl must be diluted before titrating against NaOH (if not the titre volume will be more than 50 cm3, no longer between 20 to 25 cm3)
Students should choose the appropriate indicator (methyl orange or thymolphthalein)
Students recognise to stop titration after 2 consistent results (consistent to 0.10 cm3)"
                            ></textarea>
                            <div class="flex items-center justify-between mt-2">
                                <p class="text-xs text-gray-500">Each line becomes a separate criterion ‚Ä¢ Use format: <code class="bg-gray-100 px-1 rounded">Description (Rubric)</code></p>
                                <button type="button" onclick="toggleFormatHelp()" class="text-xs text-blue-600 hover:text-blue-800 flex items-center">
                                    <i data-lucide="help-circle" class="w-3 h-3 mr-1"></i>
                                    Format Help
                                </button>
                            </div>
                        </div>
                        
                        <!-- Evaluation Strictness Slider -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Evaluation Strictness
                            </label>
                            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                                <div class="flex items-center justify-between mb-3">
                                    <span class="text-xs text-gray-500">Lenient</span>
                                    <span id="strictnessLabel" class="text-sm font-medium text-blue-600">Moderate</span>
                                    <span class="text-xs text-gray-500">Strict</span>
                                </div>
                                <input 
                                    type="range" 
                                    id="strictnessSlider" 
                                    min="1" 
                                    max="3" 
                                    value="2" 
                                    class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                                    oninput="updateStrictnessLabel(this.value)"
                                >
                                <div class="mt-3 text-xs text-gray-600" id="strictnessDescription">
                                    <strong>Moderate:</strong> Balanced evaluation requiring both concept and key details
                                </div>
                            </div>
                            <style>
                                .slider::-webkit-slider-thumb {
                                    appearance: none;
                                    width: 20px;
                                    height: 20px;
                                    background: #3B82F6;
                                    cursor: pointer;
                                    border-radius: 50%;
                                }
                                .slider::-moz-range-thumb {
                                    width: 20px;
                                    height: 20px;
                                    background: #3B82F6;
                                    cursor: pointer;
                                    border-radius: 50%;
                                    border: none;
                                }
                            </style>
                        </div>
                        
                        <!-- Prompt Library Section -->
                        <div class="border-t border-gray-200 pt-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-sm font-semibold text-gray-700">Checkbox Prompt Library</h4>
                                <div class="flex gap-2">
                                    <button onclick="refreshCheckboxPrompts()" class="text-xs text-gray-500 hover:text-gray-700 flex items-center">
                                        <i data-lucide="refresh-cw" class="w-3 h-3 mr-1"></i>
                                        Refresh
                                    </button>
                                <button onclick="openCreateCheckboxPromptModal()" class="btn btn-primary text-xs py-1 px-3">
                                    <i data-lucide="plus" class="w-3 h-3 mr-1"></i>
                                    New
                                </button>
                                </div>
                            </div>
                            
                            <!-- Search and Filter -->
                            <div class="flex gap-2 mb-3">
                                <div class="flex-1 relative">
                                    <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-3 h-3 text-gray-400"></i>
                                    <input 
                                        id="checkboxPromptSearch" 
                                        type="text" 
                                        placeholder="Search checkbox prompts..." 
                                        class="w-full pl-8 pr-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                        onkeyup="filterCheckboxPrompts()"
                                    >
                                </div>
                                <select id="checkboxPromptCategoryFilter" class="px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" onchange="filterCheckboxPrompts()">
                                    <option value="">All Categories</option>
                                </select>
                            </div>
                            
                            <!-- Prompt Cards Grid -->
                            <div id="checkboxPromptLibraryGrid" class="grid grid-cols-1 md:grid-cols-2 gap-3 max-h-64 overflow-y-auto">
                                <div class="flex items-center justify-center py-8 text-gray-500 text-sm col-span-full">
                                    <i data-lucide="loader" class="w-4 h-4 mr-2 animate-spin"></i>
                                    Loading checkbox prompts...
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <button 
                                    onclick="clearCriteria()"
                                    class="text-gray-600 hover:text-gray-800 text-sm font-medium transition-colors"
                                >
                                    üóëÔ∏è Clear All
                                </button>
                            </div>
                            <div class="flex space-x-3">
                                <button
                                    onclick="saveCriteria()"
                                    class="btn btn-accent glow px-4 py-2"
                                >
                                    üíæ Save & Apply
                                </button>
                            </div>
                        </div>

                        <div id="criteriaFeedback" class="hidden p-4 rounded-lg">
                            <!-- Feedback messages will appear here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="text-center py-16">
            <div class="w-24 h-24 mx-auto rounded-full flex items-center justify-center mb-6 shadow-sm border border-slate-200 bg-white/90">
                <i data-lucide="graduation-cap" class="w-10 h-10 text-slate-600"></i>
            </div>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">Waiting for Students</h3>
            <p class="text-gray-600 max-w-md mx-auto">Student groups will appear here when they join your session. Set up your criteria above and start recording to begin.</p>
        </div>

        <!-- Groups Grid -->
        <div id="groupsGrid" class="groups-grid hidden">
            <!-- Group cards will be inserted here -->
        </div>
    </main>